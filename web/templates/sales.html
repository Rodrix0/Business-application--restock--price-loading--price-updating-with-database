{% extends 'base.html' %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h2 class="mb-0">Ventas del día {{ fecha }}</h2>
  <div class="badge bg-dark fs-6">Total: <span class="text-danger">${{ '%.2f'|format(total_dia) }}</span></div>
  </div>
<div class="card shadow-sm">
  <div class="card-body p-0">
    <table class="table table-striped align-middle mb-0">
      <thead class="table-dark"><tr><th>Fecha</th><th>Producto</th><th class="text-center">Cantidad</th><th class="text-end">Total</th><th class="text-end"></th></tr></thead>
      <tbody>
        {% for v in ventas %}
          <tr>
            <td>{{ v.fecha }}</td>
            <td>{{ v.nombre }}</td>
            <td class="text-center">{{ v.cantidad }}</td>
            <td class="text-end">${{ '%.2f'|format(v.total) }}</td>
            <td class="text-end"><button class="btn btn-sm btn-outline-danger" data-del='{"fecha":"{{ v.fecha }}","nombre":"{{ v.nombre }}","cantidad":"{{ v.cantidad }}","total":"{{ v.total }}"}'>Eliminar</button></td>
          </tr>
        {% else %}
          <tr><td colspan="5" class="text-center text-muted py-4">Sin ventas hoy</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="card-footer text-end">
    <a class="btn btn-red" href="/api/sales/txt">Descargar TXT</a>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
document.addEventListener('click', async (e) => {
  const btn = e.target.closest('[data-del]');
  if (!btn) return;
  const payload = JSON.parse(btn.getAttribute('data-del'));
  if (!confirm('¿Eliminar esta venta?')) return;
  const res = await fetch('/api/sales/delete', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
  const data = await res.json();
  if (data.ok) location.reload(); else alert('No se pudo eliminar');
});
</script>
{% endblock %}


